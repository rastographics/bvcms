@using UtilityExtensions
@model IEnumerable<CmsData.GivingPage>
@{
    Layout = ViewExtensions2.TouchPointLayout();
    ViewBag.Title = "Online Giving Setup";
    ViewBag.PageHeader = "Online Giving Setup";
    var message = Util.TempSuccessMessage;
}
@section head{
    @Fingerprint.Css("/Content/touchpoint/lib/bootstrap-editable/css/bootstrap-editable.css")
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <style>
        .switch {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 24px;
        }

            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background-color: grey;
            -webkit-transition: .4s;
            transition: .4s;
        }

            .slider:before {
                position: absolute;
                content: "";
                height: 20px;
                width: 20px;
                left: 4px;
                top: 2px;
                bottom: 0px;
                background-color: white;
                -webkit-transition: .4s;
                transition: .4s;
            }

        input:checked + .slider {
            background-color: #68d400;
        }

            input:checked + .slider:before {
                -webkit-transform: translateX(26px);
                -ms-transform: translateX(26px);
                transform: translateX(26px);
                top: 2px;
                bottom: 0px;
            }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }


        .slider.round {
            border-radius: 34px;
        }

            .slider.round:before {
                border-radius: 50%;
            }
    </style>
}


@*<label class="switch">
    <input class="boolean-toggle" type="checkbox" id="AllowLimitToRoleForInvolvementExport" name="AllowLimitToRoleForInvolvementExport" data-toggle="toggle" data-on="True" data-off="False" data-width="100" )>
    <span class="slider round"></span>
</label>*@

<div class="row" id="table-div" style="display:none;">
    <div class="col-md-9">
        @if (message != null)
        {
            <div class="alert alert-success alert-dismissible">
                <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <strong>Success!</strong>&nbsp;&nbsp;@message
            </div>
        }
        <div id="errorMessage" class="alert alert-danger" style="display: none;">

        </div>
        <div class="box box-responsive">
            <div class="box-content">
                <div class="row hidden-xs">
                    <div class="col-sm-12">
                        <div class="pull-right">
                            <button v-on:click="createNew" class="btn btn-success"><i class="fa fa-plus-circle"></i> Giving Page</button>
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th><a v:onclick="sort('codiceCliente')" style="cursor:pointer">Enabled</a></th>
                                <th><a v:onclick="sort('ragioneSociale')" style="cursor:pointer">Page Name</a></th>
                                <th><a v:onclick="sort('provincia')" style="cursor:pointer">Skin</a></th>
                                <th><a v:onclick="sort('indirizzo')" style="cursor:pointer">Page Type</a></th>
                                <th><a v:onclick="sort('provincia')" style="cursor:pointer">Default Fund</a></th>
                                <th><a v:onclick="sort('provincia')" style="cursor:pointer">Action</a></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="items in list">
                                <td>
                                    <label class="switch">
                                        <input type="checkbox" v-model="items.Enabled" />
                                        <span class="slider round"></span>
                                    </label>
                                </td>
                                <td>{{ items.PageName }}</td>
                                <td>{{ items.Skin }}</td>
                                <td>{{ items.PageType }}</td>
                                <td>{{ items.DefaultFund }}</td>
                                <td>
                                    <a v-bind:href="'/Giving/Edit/' + items.GivingPageId" class="btn btn-sm btn-default">
                                        <i class="fa fa-pencil"></i> Edit
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button v-on:click="createNew" class="btn btn-success btn-block visible-xs-block"><i class="fa fa-plus-circle"></i> Giving Page</button>
            </div>
        </div>
    </div>
    <div class="modal fade" id="new-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Add Giving Page</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="control-label">Name</label>
                        <input ref="pageName" type="text" id="newGivingPageName" class="form-control" />
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="button" value="Cancel" class="btn btn-default" data-dismiss="modal" />
                    <input onclick="CreateNewGivingPage()" type="button" value="Submit" class="btn btn-primary" data-dismiss="modal" />
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts
{
    @Fingerprint.Script("/Content/touchpoint/lib/bootstrap-editable/js/bootstrap-editable.min.js")
    <script>
        $(document).ready(function () {
            GetGivingPageList();
        });

        function GetGivingPageList() {
            $.ajax({
                type: "GET",
                dataType: "json",
                url: "/GetGivingPageList",
                success: function (list) {
                    new Vue({
                        el: "#table-div",
                        data: {
                            list
                        },
                        methods: {
                            createNew: function (event) {
                                event.preventDefault();
                                $('#new-modal').modal();
                                //this.setFocus();
                                //setFocus();
                                //document.getElementById("newGivingPageName").value = "";
                                //document.getElementById("newGivingPageName").focus();
                                $("#newGivingPageName").val('');
                                //$("#newGivingPageName").focus();
                                //this.pageName.focus();
                                this.$nextTick(() => {
                                    this.$refs.pageName.focus()
                                })
                                //setTimeout(() => {
                                //    this.$refs.pageName.focus()
                                //})
                                //this.$refs.pageName.focus();
                            },
                            //setFocus: function () {
                            //    this.pageName.value = '';
                            //    this.pageName.focus();
                            //    //$("#newGivingPageName").val('').focus();
                            //}
                        }
                    });
                    document.getElementById("table-div").style = "display:normal;";
                },
                //error: function (data) {
                //    var asd = 1;
                //    alert("fail");
                //}
            });
        };

        function CreateNewGivingPage() {
            var pageName = document.getElementById("newGivingPageName").value;
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "/CreateNewGivingPage",
                data: {
                    pageName: pageName
                },
                success: function (response) {
                    //var asd = 1;
                    //alert(response);
                },
                //error: function (response) {
                //    var asd = 1;
                //    alert("fail");
                //}
            });
        }

                        //$("a.create-new").click(function (ev) {
                        //    ev.preventDefault();
                        //    $('#new-modal').modal();
                        //    return false;
                        //});

                        //$('#new-modal').on('shown.bs.modal', function () {
                        //    $("#newGivingPageName").val('').focus();
                        //});
    </script>
}
